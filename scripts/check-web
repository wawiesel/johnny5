#!/bin/bash

set -euo pipefail

ROOT_DIR=$(cd "$(dirname "$0")/.." && pwd)
cd "$ROOT_DIR"

echo "ðŸŽ¨ Web checks (ESLint + Playwright)"

if ! command -v npx >/dev/null 2>&1; then
  echo "âŒ Node.js/npm not found. Install Node to run web checks." >&2
  exit 1
fi

# ESLint can run without package.json via npx --yes
if [ -f "$ROOT_DIR/eslint.config.cjs" ]; then
  echo "â–¶ ESLint"
  npx --yes eslint "src/johnny5/web/static/**/*.js"
  echo "âœ… ESLint passed"
else
  echo "â„¹ï¸  ESLint config not present; skipping lint" >&2
fi

# Playwright requires package.json and node_modules
if [ -x "$ROOT_DIR/scripts/pre-commit-playwright-tests" ]; then
  if [ ! -f "$ROOT_DIR/package.json" ]; then
    echo "âš ï¸  Playwright requires package.json; skipping e2e tests" >&2
  elif [ ! -d "$ROOT_DIR/node_modules" ]; then
    echo "âš ï¸  Playwright requires node_modules; run 'npm install' first. Skipping e2e tests." >&2
  else
    echo "â–¶ Playwright"
    "$ROOT_DIR/scripts/pre-commit-playwright-tests"
  fi
else
  echo "â„¹ï¸  Playwright helper script not present; skipping e2e" >&2
fi

exit 0


