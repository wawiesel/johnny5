<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Johnny5 Web Viewer</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ðŸ¤–</text></svg>">
    <link rel="stylesheet" href="/static/css/0_layout.css">
    <link rel="stylesheet" href="/static/css/color/{{ color_scheme|default('debug') }}.css" id="color-scheme-link">
    <link rel="stylesheet" href="/static/css/1_pdf.css">
    <link rel="stylesheet" href="/static/css/2_ann.css">
    <link rel="stylesheet" href="/static/css/3_rec.css">
    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>

<body data-initial-theme="{{ color_scheme|default('debug') }}">
    <div id="app">
        <div class="app-container">
            <svg id="connection-lines-overlay"></svg>
            <!-- PDF COLUMN (nested grid) -->
            <div id="pdf-col">
                <div id="color-mode-selector" class="box">i</div>
                <div id="pdf-x-density" class="box">
                    <canvas id="x-density-chart"></canvas>
                </div>
                <div id="pdf-y-density" class="box">
                    <!-- Canvases will be created dynamically -->
                </div>
                <div id="pdf-viewer" class="box">
                    <div class="pdf-controls-overlay">
                        <button id="zoom-out" class="pdf-control-btn" title="Zoom Out">
                            <svg class="pdf-control-icon" viewBox="0 0 24 24">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                                <line x1="8" y1="11" x2="14" y2="11"></line>
                            </svg>
                        </button>
                        <span id="zoom-level" class="pdf-zoom-display">100%</span>
                        <button id="zoom-in" class="pdf-control-btn" title="Zoom In">
                            <svg class="pdf-control-icon" viewBox="0 0 24 24">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                                <line x1="11" y1="8" x2="11" y2="14"></line>
                                <line x1="8" y1="11" x2="14" y2="11"></line>
                            </svg>
                        </button>
                        <button id="fit-width" class="pdf-control-btn" title="Fit Width">
                            <svg class="pdf-control-icon" viewBox="0 0 24 24">
                                <path d="M3 12h18"></path>
                                <path d="M3 6h18"></path>
                                <path d="M3 18h18"></path>
                            </svg>
                        </button>
                        <button id="fit-height" class="pdf-control-btn" title="Fit Height">
                            <svg class="pdf-control-icon" viewBox="0 0 24 24">
                                <path d="M12 3v18"></path>
                                <path d="M6 3v18"></path>
                                <path d="M18 3v18"></path>
                            </svg>
                        </button>
                    </div>

                    <div class="pdf-page-nav-overlay">
                        <button id="page-prev" class="pdf-control-btn" title="Previous Page">
                            <svg class="pdf-control-icon" viewBox="0 0 24 24">
                                <polyline points="15 18 9 12 15 6" fill="none" stroke="currentColor" stroke-width="2"></polyline>
                            </svg>
                        </button>
                        <input type="number" id="page-input" class="pdf-page-input" min="1" max="1" value="1" title="Go to page">
                        <span class="pdf-page-separator">/</span>
                        <span id="page-total" class="pdf-page-total">1</span>
                        <button id="page-next" class="pdf-control-btn" title="Next Page">
                            <svg class="pdf-control-icon" viewBox="0 0 24 24">
                                <polyline points="9 18 15 12 9 6" fill="none" stroke="currentColor" stroke-width="2"></polyline>
                            </svg>
                        </button>
                    </div>

                    <div id="pdf-scroller">
                        <div class="pdf-canvas-container" id="pdf-canvas-container">
                            <canvas id="pdf-canvas"></canvas>
                        </div>
                        <div class="overlay-container" id="overlay-container">
                            <!-- Annotations will be rendered here -->
                        </div>
                    </div>
                </div>
                <div id="pdf-options" class="box" style="position: relative;">
                <input type="checkbox" id="pdf-options-cb" class="options-cb" style="display:none;">
                <label for="pdf-options-cb" id="pdf-options-toggle" class="options-toggle" title="Collapse/expand">â–¼</label>
                <div class="pdf-controls">
                    <div class="pdf-control-group">
                            <input type="file" id="pdf-file-input" accept=".pdf" style="display: none;">
                            <button id="load-pdf-btn" class="pdf-control-btn">Load PDF</button>
                            <span id="current-file-name" class="pdf-file-display">No file</span>
                        </div>
                    </div>
                </div>
                <div id="pdf-log" class="box" style="position: relative;">
                    <button id="pdf-log-copy-btn" class="pdf-log-copy-btn" title="Copy log to clipboard">
                        <svg class="pdf-log-copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                    </button>
                    <div class="pdf-log-content" id="pdf-log-content">
                    </div>
                </div>
            </div>

            <!-- ANNOTATIONS COLUMN -->
            <div id="ann-col">
                <div id="ann-progress" class="box">P</div>
                <div id="ann-list" class="box">
                    <div class="annotation-list" id="annotation-list">
                        <!-- Dynamically generated annotations will appear here -->
                    </div>
                </div>
                <div id="ann-toggles" class="box" style="position: relative;">
                    <div class="ann-toggles-resize-handle" title="Drag to resize"></div>
                    <div class="ann-toggles-container">
                        <!-- Dynamically generated checkboxes will appear here -->
                    </div>
                </div>
            </div>

            <!-- RECONSTRUCTION COLUMN -->
            <div id="rec-col">
                <div id="rec-x-density" class="box">
                    <canvas id="x-density-right-chart"></canvas>
                </div>
                <div id="rec-indicator" class="box">r</div>
                <div id="rec-viewer" class="box">
                    <div class="not-implemented">Reconstructed Content</div>
                </div>
                <div id="rec-y-density" class="box">
                    <!-- Canvases will be created dynamically -->
                </div>
                <div id="rec-options" class="box" style="position: relative;">
                    <input type="checkbox" id="rec-options-cb" class="options-cb" style="display:none;">
                    <label for="rec-options-cb" id="rec-options-toggle" class="options-toggle" title="Collapse/expand">â–¼</label>
                    <div class="rec-controls">
                        <div class="rec-control-group">Prototype: line 1 of filler text.</div>
                        <div class="rec-control-group">Prototype: line 2 of filler text.</div>
                        <div class="rec-control-group">Prototype: line 3 of filler text.</div>
                    </div>
                </div>
                <div id="rec-log" class="box" style="position: relative;">
                    <div class="rec-log-content" id="rec-log-content">
                        <div class="rec-log-entry">Waiting for reconstruct logs 1...</div>
                        <div class="rec-log-entry">Waiting for reconstruct logs 2...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/density-charts.js"></script>
    <script src="/static/theme-toggle.js"></script>
    <script src="/static/app.js"></script>
    <script src="/static/resize.js"></script>
</body>

</html>
